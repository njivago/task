import{o as S,s as f,u as k,n as D,a as E,b as O,c as I,d as V,e as $,v as j,r as u,j as e,Q as F,R as A,f as Q,g as q,h as L}from"./vendor.js";const M=S({name:f(),category:f(),value:k([f(),D(),E()]).optional(),id:f()}),K=O(M),B=a=>I({queryKey:["autocomplete",a],queryFn:async()=>{const s=await(await fetch("https://652f91320b8d8ddac0b2b62b.mockapi.io/autocomplete")).json();return K.parse(s).filter(r=>r.name.toLowerCase().includes(a.toLowerCase()))},enabled:a.length>0}),w=V((a,o)=>({tags:[],result:null,addTag:s=>a(t=>({tags:[...t.tags,s]})),addOperator:s=>a(t=>({tags:[...t.tags,{id:j(),name:s,category:s,value:s}]})),removeTag:s=>a(t=>({tags:t.tags.filter((r,n)=>n!==s)})),updateTagValue:(s,t)=>a(r=>({tags:r.tags.map((n,m)=>m===s&&typeof n!="string"?{...n,value:t}:n)})),calculateResult:()=>{const{tags:s}=o();try{const t=s.map(n=>typeof n=="string"?n:n.value).join(" "),r=$(t);a({result:r})}catch(t){console.error("Calculation error:",t),a({result:null})}}})),N=u.memo(({value:a,category:o,onValueChange:s,isOpen:t})=>e.jsx("div",{role:"dialog","aria-modal":"true","aria-hidden":!t,className:"absolute top-full mt-1 right-0 w-48 bg-white border rounded-lg shadow-lg z-10",children:e.jsx("form",{className:"p-3",onSubmit:r=>r.preventDefault(),children:e.jsxs("fieldset",{children:[e.jsx("legend",{className:"sr-only",children:"Tag Value Editor"}),e.jsxs("div",{className:"mb-2",children:[e.jsx("label",{htmlFor:"tag-value",className:"text-sm text-gray-600 block mb-1",children:"Value:"}),e.jsx("input",{id:"tag-value",type:"text",value:a,onChange:r=>s(r.target.value),className:"w-full border rounded px-2 py-1 text-sm focus:outline-none focus:border-blue-500","aria-label":"Tag value"})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Category:"}),e.jsxs("span",{role:"status","aria-live":"polite",children:[" ",o]})]})]})})}));N.displayName="TagDropdown";const C=u.memo(({tag:a,index:o})=>{const[s,t]=u.useState(!1),{updateTagValue:r,calculateResult:n,removeTag:m}=w(),p=u.useRef(null),h=`tag-button-${o}`,b=`tag-dropdown-${o}`,d=u.useCallback(i=>{p.current&&!p.current.contains(i.target)&&t(!1)},[]);u.useEffect(()=>(document.addEventListener("mousedown",d),()=>document.removeEventListener("mousedown",d)),[d]);const x=u.useCallback(i=>{r(o,i),n()},[o,r,n]),g=u.useCallback(()=>{t(i=>!i)},[]),y=()=>{m(o),n()};return e.jsxs("div",{className:"relative inline-flex items-center",ref:p,role:"group","aria-labelledby":h,children:[e.jsxs("div",{className:"bg-blue-100 rounded flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-medium px-2",role:"text",children:a.value}),e.jsxs("div",{children:[e.jsx("button",{id:h,onClick:g,className:"p-1 text-gray-600 hover:bg-blue-400 focus:outline-none transition duration-200 ease-in-out ","aria-expanded":s,"aria-controls":b,"aria-label":`Edit ${a.name} value`,children:e.jsx("span",{className:"text-xs","aria-hidden":"true",children:"▼"})}),e.jsx("button",{onClick:y,className:"text-red-600 hover:bg-red-200 p-1 transition duration-200 ease-in-out focus:outline-none","aria-label":`Remove ${a.name}`,children:e.jsx("b",{children:"×"})})]})]}),s&&e.jsx(N,{value:a.value,category:a.category,onValueChange:x,isOpen:s})]})});C.displayName="Tag";const v=["+","-","*","/","^","(",")"],P=()=>{const[a,o]=u.useState(""),[s,t]=u.useState(!1),r=u.useRef(null),{tags:n,result:m,addTag:p,addOperator:h,removeTag:b,calculateResult:d}=w(),[x,g]=u.useState(null),{data:y=[]}=B(a),i=l=>{const c=l.target.value;/^\d+$/.test(c)?(o(c),t(!0)):(o(c),t(!1))},T=l=>{l.key==="Enter"&&/^\d+$/.test(a)?(p({id:Date.now().toString(),name:a,category:"number",value:parseFloat(a)}),o(""),d()):l.key==="Backspace"&&a===""&&n.length>0?(l.preventDefault(),b(n.length-1),d()):v.includes(l.key)&&(l.preventDefault(),h(l.key),o(""),g(null),d())},R=l=>{var c;if(n.length!==0&&!v.includes(n[n.length-1].name)){g("You must add an operator before selecting a suggestion.");return}p(l),o(""),t(!1),g(null),(c=r.current)==null||c.focus(),d()};return e.jsxs("div",{className:"w-full max-w-2xl",children:[e.jsxs("div",{className:"border rounded-lg p-2 flex flex-wrap gap-2 min-h-[48px] bg-white",children:[n.map((l,c)=>e.jsx(C,{tag:l,index:c},`${c}-${l.category}`)),e.jsx("input",{ref:r,type:"text",className:"w-full px-3 py-2 border-2 rounded-md focus:outline-none focus:border-purple-600 placeholder-gray-400",value:a,onChange:i,onKeyDown:T,placeholder:"Enter formula..."})]}),s&&a&&e.jsx("div",{className:"mt-1 border border-gray-200 rounded-md shadow-sm max-h-60 overflow-y-auto bg-white",children:y.map(l=>e.jsxs("div",{className:"p-2 hover:bg-gray-100 cursor-pointer",onClick:()=>R(l),children:[l.name," (",l.category,")"]},j()))}),m!==null&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg border",children:[e.jsx("span",{className:"font-semibold",children:"Result: "}),e.jsx("span",{children:m})]}),x&&e.jsx("div",{className:"mt-2 error-message text-red-600",children:x})]})},z=()=>e.jsx("div",{className:"min-h-screen bg-gray-50 p-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Formula Editor"}),e.jsx(P,{})]})}),W=new F({defaultOptions:{queries:{staleTime:1e3*60*5,refetchOnWindowFocus:!1,retry:1}}});A.createRoot(document.getElementById("root")).render(e.jsx(Q.StrictMode,{children:e.jsxs(q,{client:W,children:[e.jsx(z,{}),e.jsx(L,{initialIsOpen:!1})]})}));
//# sourceMappingURL=main.js.map
